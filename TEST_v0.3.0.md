# 测试指南 - v0.3.0 版本控制功能

## 🎯 测试目标

验证 v0.3.0 新增的版本控制功能是否正常工作。

## 📋 前置准备

1. 确保已经安装 v0.2.0 并有一些测试数据
2. 更新到 v0.3.0：
   ```bash
   cd /home/hezihua/workspace/prompt_manager
   pnpm run build
   ```
3. 在 Chrome 扩展页面重新加载插件

## ✅ 测试清单

### 1. 版本快照自动创建 ⭐⭐⭐

**测试步骤：**
1. 打开 Side Panel
2. 编辑一个已存在的 Prompt
3. 修改一些标签或参数
4. 点击"保存"
5. 再次编辑，再次保存（重复 2-3 次）

**预期结果：**
- ✅ 每次保存都成功
- ✅ 没有报错

### 2. 查看版本历史 ⭐⭐⭐

**测试步骤：**
1. 在 Prompt 卡片上找到蓝色的"历史"图标按钮
2. 点击"历史"按钮

**预期结果：**
- ✅ 打开版本历史模态框
- ✅ 显示时间线视图
- ✅ 显示所有历史版本（按时间倒序）
- ✅ 当前版本有"当前"标签（绿色）
- ✅ 每个版本显示：
  - 版本号（v1, v2, v3...）
  - 标题
  - 创建时间
  - 标签预览
  - 操作按钮

### 3. 评分功能 ⭐⭐

**测试步骤：**
1. 在时间线中点击某个版本的星星
2. 尝试给不同版本打不同的分数

**预期结果：**
- ✅ 星星可以点击
- ✅ 评分立即显示（黄色星星）
- ✅ 刷新后评分保持

### 4. 图片上传功能 ⭐⭐⭐

**测试步骤：**
1. 编辑一个 Prompt（必须是已存在的）
2. 在编辑器下方找到"关联图片"区域
3. 点击上传区域，选择一张图片（<5MB）
4. 在"快照备注"中输入一些文字
5. 点击保存

**预期结果：**
- ✅ 图片成功上传并预览
- ✅ 可以更换图片
- ✅ 可以移除图片
- ✅ 保存成功
- ✅ 在时间线中看到刚上传的图片

### 5. 版本对比功能 ⭐⭐⭐

**测试步骤：**
1. 在时间线中点击第一个版本的"对比"图标
2. 再点击第二个版本的"对比"图标

**预期结果：**
- ✅ 打开版本对比模态框
- ✅ 显示两个版本的信息
- ✅ 显示详细的差异列表：
  - 新增的标签（绿色）
  - 移除的标签（红色，带删除线）
  - 权重变化（蓝色）
- ✅ 如果有图片，显示图片对比
- ✅ 可以关闭对比视图

### 6. 版本恢复功能 ⭐⭐⭐

**测试步骤：**
1. 在时间线中找到一个旧版本
2. 点击绿色的"恢复"图标
3. 确认恢复操作
4. 关闭时间线，查看 Prompt 卡片

**预期结果：**
- ✅ 弹出确认对话框
- ✅ 恢复成功提示
- ✅ Prompt 内容已恢复到旧版本
- ✅ 时间线中增加了一个新的快照（恢复前的自动备份）
- ✅ 数据完整性良好

### 7. 删除快照功能 ⭐⭐

**测试步骤：**
1. 在时间线中点击某个版本的"删除"图标（红色垃圾桶）
2. 确认删除

**预期结果：**
- ✅ 弹出确认对话框
- ✅ 删除成功
- ✅ 版本从时间线中消失
- ✅ 其他版本不受影响

### 8. 快照备注功能 ⭐

**测试步骤：**
1. 编辑 Prompt 时添加快照备注
2. 保存后在时间线中查看

**预期结果：**
- ✅ 备注显示在版本卡片上（黄色背景）

### 9. 空状态测试 ⭐

**测试步骤：**
1. 创建一个新的 Prompt
2. 立即点击"历史"按钮

**预期结果：**
- ✅ 显示"还没有版本快照"
- ✅ 提示信息友好

### 10. 取消对比功能 ⭐

**测试步骤：**
1. 点击第一个版本的"对比"按钮
2. 注意顶部的提示条
3. 点击提示条中的"取消"

**预期结果：**
- ✅ 显示蓝色提示条："已选择版本 X，请再选择一个版本进行对比"
- ✅ 点击"取消"后，提示条消失
- ✅ 对比选择被重置

## 🐛 常见问题

### 问题 1：历史按钮不显示
**原因**：可能是 Prompt 卡片组件未正确传递 `onViewHistory` 属性
**解决**：检查 `SidePanel.tsx` 中是否正确传递了该属性

### 问题 2：保存时没有创建快照
**原因**：只有编辑模式（`projectId` 存在）才会创建快照
**解决**：新建 Prompt 不会创建快照，需要先保存，然后编辑后再保存才会创建

### 问题 3：图片上传失败
**原因**：可能文件过大或格式不支持
**解决**：
- 确保图片小于 5MB
- 确保格式为 JPG/PNG/GIF
- 检查浏览器控制台的错误信息

### 问题 4：版本对比显示"无变化"
**原因**：两个版本确实没有差异
**解决**：选择差异较大的版本进行对比

## 📊 性能测试

### 测试场景 1：大量快照
1. 创建 20+ 个版本快照
2. 打开时间线查看性能

**预期**：
- 加载时间 < 1 秒
- 滚动流畅

### 测试场景 2：大图片
1. 上传接近 5MB 的图片
2. 查看时间线和对比视图

**预期**：
- 上传时间 < 3 秒
- 预览正常

### 测试场景 3：快速连续操作
1. 快速打开/关闭时间线
2. 快速切换对比的版本
3. 快速评分

**预期**：
- 无卡顿
- 无崩溃
- 数据同步正常

## 📝 测试记录模板

```
测试日期：2026-02-15
测试人：___________
Chrome 版本：___________

| 测试项 | 通过 | 失败 | 备注 |
|--------|------|------|------|
| 1. 版本快照自动创建 | ✅ | ❌ | |
| 2. 查看版本历史 | ✅ | ❌ | |
| 3. 评分功能 | ✅ | ❌ | |
| 4. 图片上传功能 | ✅ | ❌ | |
| 5. 版本对比功能 | ✅ | ❌ | |
| 6. 版本恢复功能 | ✅ | ❌ | |
| 7. 删除快照功能 | ✅ | ❌ | |
| 8. 快照备注功能 | ✅ | ❌ | |
| 9. 空状态测试 | ✅ | ❌ | |
| 10. 取消对比功能 | ✅ | ❌ | |

总体评价：___________
发现的问题：___________
```

## 🎯 推荐测试流程

1. **基础功能**（15分钟）
   - 测试 1, 2, 3
   
2. **高级功能**（20分钟）
   - 测试 4, 5, 6
   
3. **边界情况**（10分钟）
   - 测试 7, 8, 9, 10
   
4. **性能测试**（15分钟）
   - 性能测试 1, 2, 3

**总计：约 60 分钟**

## ✨ 测试完成后

如果一切正常，恭喜！v0.3.0 版本控制功能已经可以正常使用了！🎉

如果发现问题，请记录：
1. 问题现象
2. 复现步骤
3. 浏览器控制台的错误信息
4. 截图
